# <!-- Powered by BMAD™ Core -->
# Story 1.6: Visualização do Evento e Dashboard Básico

## Status

**Draft**

## Story

**As a** organizador,
**I want** visualizar os detalhes do meu evento criado,
**So that** eu possa verificar se as informações estão corretas.

## Acceptance Criteria

1. Página de visualização acessível via URL único (/evento/[id])
2. Exibição clara de: nome, data, local, lista de itens
3. URL compartilhável visível e copiável
4. Design mobile-first com texto legível
5. Navegação simples de volta para criação

## Tasks / Subtasks

- [ ] Implementar API endpoint GET /events/:id (AC: 1)
  - [ ] Criar rota GET `/events/:id` no backend seguindo API specification
  - [ ] Implementar eventController.getEventById() com validação de eventId
  - [ ] Integrar com modelo Event existente para buscar dados completos
  - [ ] Incluir relacionamentos com EventItems na response (populate items)
  - [ ] Implementar tratamento de erro para evento não encontrado (404)

- [ ] Implementar componente EventDashboard (AC: 2, 4)
  - [ ] Criar componente EventDashboard em `apps/web/src/components/event/EventDashboard/`
  - [ ] Exibir informações do evento: name, date, location, estimatedParticipants
  - [ ] Implementar lista de EventItems com categorização (carne, bebidas, carvão)
  - [ ] Aplicar CSS Modules responsivo com design mobile-first
  - [ ] Adicionar loading state e error handling

- [ ] Implementar página EventDetails (AC: 1, 5)
  - [ ] Criar página EventDetails em `apps/web/src/pages/EventDetails/`
  - [ ] Configurar rota `/event/:id` no React Router
  - [ ] Integrar com eventService.getEvent() para carregamento de dados
  - [ ] Implementar useParams() para captura do eventId da URL
  - [ ] Adicionar navegação de volta para home page

- [ ] Implementar funcionalidade de compartilhamento (AC: 3)
  - [ ] Criar componente ShareEvent em `apps/web/src/components/event/ShareEvent/`
  - [ ] Exibir URL completa do evento de forma visível
  - [ ] Implementar botão "Copiar Link" com feedback visual
  - [ ] Usar navigator.clipboard API com fallback para browsers antigos
  - [ ] Adicionar indicação visual de sucesso ao copiar

- [ ] Implementar testes unitários (Testing Strategy)
  - [ ] Criar teste do componente EventDashboard em `apps/web/tests/components/EventDashboard.test.js`
  - [ ] Testar renderização de dados do evento e lista de itens
  - [ ] Criar teste da página EventDetails em `apps/web/tests/pages/EventDetails.test.js`
  - [ ] Testar carregamento de dados e estados de loading/error
  - [ ] Criar teste do componente ShareEvent com mock da clipboard API

## Dev Notes

### Previous Story Context

[Source: Story 1.5 completion notes]
- EventForm implementado e funcional para criação de eventos
- API backend com modelo Event operacional 
- POST /events endpoint criando eventos com sucesso
- Template básico de itens (carne, bebidas, carvão) sendo gerado automaticamente
- Redirecionamento pós-criação deve apontar para `/event/:id` (esta story)
- organizerId sendo gerado automaticamente e usado para controle de acesso

### Data Models Context

[Source: architecture/data-models.md#event-model]
**Event Schema para Display:**
- id: String (UUID) - usado como parâmetro na URL `/event/:id`
- name: String - título principal a ser exibido
- date: Date - deve ser formatada para exibição (ex: "15 de Outubro de 2025, 14:00")
- location: String - endereço/local do evento
- organizerId: String - para controle de acesso futuro
- status: String - exibir status atual ('draft', 'active', etc.)
- estimatedParticipants: Number - quantas pessoas o organizador espera
- createdAt: Date - quando o evento foi criado

[Source: architecture/data-models.md#eventitem-model]
**EventItem Display Requirements:**
- Agrupar itens por categoria: 'carne', 'bebidas', 'carvao', 'acompanhamentos', 'extras'
- Exibir para cada item: name, quantity + unit, estimatedCost formatado em R$
- Mostrar se isTemplate=true (itens do template básico)
- Total de custos calculado dinamicamente

### API Integration Context

[Source: architecture/api-specification.md#rest-api-specification]
**GET /events/:id Endpoint:**
- URL: `${API_BASE_URL}/events/:id`
- Method: GET
- Response: 200 OK com evento + relacionamentos (EventItems)
- Error: 404 Not Found se evento não existir, 400 Bad Request se ID inválido
- Response deve incluir campo eventId para construção de URL compartilhável

[Source: architecture/frontend-architecture.md#frontend-services-layer]
**EventService Extension:**
```javascript
// Adicionar ao eventService.js existente
async getEvent(eventId) {
  const response = await api.get(`/events/${eventId}`);
  return response;
}

async getEventWithItems(eventId) {
  const response = await api.get(`/events/${eventId}?includeItems=true`);
  return response;
}
```

### Component Architecture Context

[Source: architecture/frontend-architecture.md#component-architecture]
**Component Organization:**
```
apps/web/src/components/event/EventDashboard/
├── EventDashboard.jsx           // Componente principal de exibição
├── EventDashboard.module.css    // Estilos responsivos
├── components/
│   ├── EventHeader.jsx         // Nome, data, local
│   ├── EventItemsList.jsx      // Lista categorizada de itens
│   └── EventStats.jsx          // Estatísticas (participantes, custo total)
└── index.js                    // Export barrel

apps/web/src/components/event/ShareEvent/
├── ShareEvent.jsx              // Funcionalidade de compartilhamento
├── ShareEvent.module.css       // Estilos do componente
└── index.js                    // Export
```

[Source: architecture/frontend-architecture.md#routing-architecture]
**Routing Configuration:**
- Rota `/event/:id` deve renderizar EventDetails page
- useParams() para capturar eventId da URL
- Implementar loading state enquanto carrega dados do evento
- Redirect para home se evento não encontrado (404)

### Mobile-First Design Requirements

[Source: architecture/coding-standards.md + PRD visual requirements]
**Design Specifications:**
- Layout responsivo com breakpoints: mobile (<768px), tablet (768px-1024px), desktop (>1024px)
- Tipografia legível: títulos min 1.5rem, texto min 1rem
- Espaçamento adequado: min 1rem entre seções principais
- Botões com área de toque min 44px (acessibilidade mobile)
- Cores contrastantes para legibilidade
- CSS Modules com naming convention kebab-case

### URL Sharing Implementation

**URL Construction Pattern:**
```javascript
// apps/web/src/utils/urlHelpers.js
const generateShareableUrl = (eventId) => {
  const baseUrl = window.location.origin;
  return `${baseUrl}/event/${eventId}`;
};

// Clipboard API com fallback
const copyToClipboard = async (text) => {
  if (navigator.clipboard) {
    await navigator.clipboard.writeText(text);
  } else {
    // Fallback para browsers antigos
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
  }
};
```

### File Locations for Implementation

[Source: architecture/unified-project-structure.md]
**Frontend Files:**
- `apps/web/src/pages/EventDetails/EventDetails.jsx` - página principal
- `apps/web/src/pages/EventDetails/EventDetails.module.css` - estilos da página
- `apps/web/src/components/event/EventDashboard/EventDashboard.jsx` - dashboard
- `apps/web/src/components/event/EventDashboard/EventDashboard.module.css` - estilos
- `apps/web/src/components/event/ShareEvent/ShareEvent.jsx` - compartilhamento
- `apps/web/src/utils/formatters.js` - formatação de data/moeda (se não existir)
- `apps/web/src/utils/urlHelpers.js` - helpers de URL

**Backend Files:**
- `apps/api/src/controllers/eventController.js` - adicionar método getEventById
- `apps/api/src/routes/events.js` - adicionar rota GET /:id

**Test Files:**
- `apps/web/tests/components/EventDashboard.test.js`
- `apps/web/tests/components/ShareEvent.test.js`
- `apps/web/tests/pages/EventDetails.test.js`
- `apps/api/tests/controllers/eventController.test.js`

### Error Handling Requirements

[Source: architecture/error-handling-strategy.md]
**Frontend Error Scenarios:**
- Evento não encontrado (404) → Mostrar mensagem + link para criar novo evento
- Erro de rede → Mostrar botão "Tentar Novamente"
- ID de evento inválido → Redirect para home com mensagem de erro
- Falha ao copiar link → Fallback manual + notificação

**Error Response Format:**
```javascript
// Padrão de response de erro da API
{
  error: {
    message: "Event not found",
    code: "EVENT_NOT_FOUND"
  },
  meta: {
    timestamp: "2025-10-02T...",
    requestId: "uuid"
  }
}
```

### Testing

[Source: architecture/testing-strategy.md#frontend-tests]
**Required Test Coverage:**
- Renderização do EventDashboard com dados mockados
- Exibição correta de informações do evento (nome, data, local)
- Agrupamento e exibição de EventItems por categoria
- Funcionalidade de copiar link (com mock da clipboard API)
- Estados de loading e erro da página EventDetails
- Navegação e routing entre páginas

**Test File Locations:**
- `apps/web/tests/components/EventDashboard.test.js`
- `apps/web/tests/components/ShareEvent.test.js`
- `apps/web/tests/pages/EventDetails.test.js`
- `apps/api/tests/controllers/eventController.test.js`

**Testing Patterns:**
```javascript
// Mock de dados para testes
const mockEventData = {
  id: 'test-event-123',
  name: 'Churrasco de Teste',
  date: new Date('2025-10-15T14:00:00.000Z'),
  location: 'Casa do João',
  estimatedParticipants: 8,
  items: [
    { name: 'Picanha', category: 'carne', quantity: 3.2, unit: 'kg' },
    { name: 'Cerveja', category: 'bebidas', quantity: 16, unit: 'unidade' }
  ]
};

// Mock do clipboard API
Object.assign(navigator, {
  clipboard: {
    writeText: jest.fn()
  }
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-02 | 1.0 | Story criada para visualização de evento e dashboard básico | Bob (Scrum Master) |